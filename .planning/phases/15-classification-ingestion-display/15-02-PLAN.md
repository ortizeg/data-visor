---
phase: 15-classification-ingestion-display
plan: 02
type: execute
wave: 2
depends_on: ["15-01"]
files_modified:
  - frontend/src/types/dataset.ts
  - frontend/src/types/scan.ts
  - frontend/src/app/datasets/[datasetId]/page.tsx
  - frontend/src/components/grid/grid-cell.tsx
  - frontend/src/components/grid/image-grid.tsx
  - frontend/src/components/detail/sample-modal.tsx
  - frontend/src/components/detail/annotation-list.tsx
  - frontend/src/components/stats/stats-dashboard.tsx
  - frontend/src/components/stats/annotation-summary.tsx
  - frontend/src/components/ingest/scan-results.tsx
autonomous: true

must_haves:
  truths:
    - "User sees class label badges on grid thumbnails for classification datasets instead of bbox overlays"
    - "User sees GT class label prominently in sample detail modal with a dropdown to change it"
    - "Statistics dashboard shows 'Labeled Images' and 'Classes' instead of 'GT Annotations' and 'Categories' for classification datasets"
    - "Detection-only elements (bbox area histogram, IoU slider) are hidden for classification datasets"
    - "Scan results page shows 'Classification JSONL' format badge for classification datasets"
  artifacts:
    - path: "frontend/src/types/dataset.ts"
      provides: "Dataset type with dataset_type field"
      contains: "dataset_type"
    - path: "frontend/src/components/grid/grid-cell.tsx"
      provides: "ClassBadge rendering for classification datasets"
      contains: "ClassBadge"
    - path: "frontend/src/components/detail/sample-modal.tsx"
      provides: "Class label display and dropdown editor"
      contains: "classification"
    - path: "frontend/src/components/stats/stats-dashboard.tsx"
      provides: "Detection-only tab hiding for classification"
      contains: "datasetType"
  key_links:
    - from: "frontend/src/app/datasets/[datasetId]/page.tsx"
      to: "frontend/src/components/grid/image-grid.tsx"
      via: "datasetType prop threading"
      pattern: "datasetType"
    - from: "frontend/src/components/grid/grid-cell.tsx"
      to: "frontend/src/types/dataset.ts"
      via: "dataset_type determines badge vs overlay"
      pattern: "classification"
    - from: "frontend/src/components/detail/sample-modal.tsx"
      to: "PATCH /annotations/{id}/category"
      via: "category update mutation"
      pattern: "category"
---

<objective>
Adapt the frontend to display classification datasets appropriately: class label badges on grid, class label with dropdown in detail modal, classification-aware statistics, and format badge in scan results.

Purpose: Users browsing classification datasets see class-appropriate UI instead of detection-oriented displays (no bbox overlays, no area histograms). Classification labels are the primary annotation visual.
Output: Updated grid, modal, stats, and scan results components with datasetType-aware branching.
</objective>

<execution_context>
@/Users/ortizeg/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ortizeg/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/15-classification-ingestion-display/15-RESEARCH.md
@.planning/phases/15-classification-ingestion-display/15-01-SUMMARY.md
@frontend/src/types/dataset.ts
@frontend/src/types/scan.ts
@frontend/src/app/datasets/[datasetId]/page.tsx
@frontend/src/components/grid/grid-cell.tsx
@frontend/src/components/grid/image-grid.tsx
@frontend/src/components/detail/sample-modal.tsx
@frontend/src/components/detail/annotation-list.tsx
@frontend/src/components/stats/stats-dashboard.tsx
@frontend/src/components/stats/annotation-summary.tsx
@frontend/src/components/ingest/scan-results.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Types, page threading, grid class badges, and scan results format badge</name>
  <files>
    frontend/src/types/dataset.ts
    frontend/src/types/scan.ts
    frontend/src/app/datasets/[datasetId]/page.tsx
    frontend/src/components/grid/grid-cell.tsx
    frontend/src/components/grid/image-grid.tsx
    frontend/src/components/ingest/scan-results.tsx
  </files>
  <action>
    **1. TypeScript types**:
    - `frontend/src/types/dataset.ts`: Add `dataset_type: string;` to the `Dataset` interface (after `prediction_count`). Default is `"detection"`.
    - `frontend/src/types/scan.ts`: No structural change needed -- `ScanResult.format` is already a string and will carry `"classification_jsonl"`.

    **2. Dataset page prop threading** (`frontend/src/app/datasets/[datasetId]/page.tsx`):
    - The page fetches the dataset object which now includes `dataset_type`.
    - Thread `datasetType={dataset.dataset_type}` as a prop to `<ImageGrid>`, `<SampleModal>`, and `<StatsDashboard>` (and any stats sub-components that need it).
    - Also thread it to any component that renders differently for classification vs detection.

    **3. Grid class badges** (`frontend/src/components/grid/grid-cell.tsx`):
    - Add `datasetType?: string` prop to GridCell.
    - When `datasetType === "classification"`:
      - Do NOT render `<AnnotationOverlay>` (skip bbox rendering entirely)
      - Instead render a `ClassBadge` inline component:
        ```tsx
        function ClassBadge({ label }: { label?: string }) {
          if (!label) return null;
          return (
            <div className="absolute bottom-1 left-1 z-10">
              <span className="rounded bg-black/60 px-1.5 py-0.5 text-[10px] font-semibold text-white">
                {label}
              </span>
            </div>
          );
        }
        ```
      - Extract the GT annotation's `category_name` from the annotations map for this sample: `const gtAnnotation = annotations?.find(a => a.source === "ground_truth");`
      - Render `<ClassBadge label={gtAnnotation?.category_name} />`
    - When `datasetType !== "classification"` (or undefined): render existing `<AnnotationOverlay>` as before (no change).

    **4. ImageGrid prop threading** (`frontend/src/components/grid/image-grid.tsx`):
    - Add `datasetType?: string` prop to ImageGrid.
    - Pass it through to each `<GridCell datasetType={datasetType} />`.

    **5. Scan results format badge** (`frontend/src/components/ingest/scan-results.tsx`):
    - Where the format is displayed, show "Classification JSONL" when `format === "classification_jsonl"` and "COCO" when `format === "coco"`.
    - Use the existing badge/styling pattern (likely a colored span). Example: a small badge showing the format type near the dataset name.
  </action>
  <verify>
    - `cd frontend && npx tsc --noEmit` passes without errors
    - `cd frontend && npm run build` succeeds
    - Grep confirms: `grep -r "ClassBadge" frontend/src/components/grid/grid-cell.tsx`
    - Grep confirms: `grep -r "datasetType" frontend/src/app/datasets/*/page.tsx`
  </verify>
  <done>Dataset type flows from API through page to grid. Classification datasets show class label badges instead of bbox overlays. Scan results show format badge. TypeScript compiles cleanly.</done>
</task>

<task type="auto">
  <name>Task 2: Detail modal class label display/edit and classification-aware statistics</name>
  <files>
    frontend/src/components/detail/sample-modal.tsx
    frontend/src/components/detail/annotation-list.tsx
    frontend/src/components/stats/stats-dashboard.tsx
    frontend/src/components/stats/annotation-summary.tsx
  </files>
  <action>
    **1. Sample modal** (`frontend/src/components/detail/sample-modal.tsx`):
    - Add `datasetType?: string` prop.
    - When `datasetType === "classification"`:
      - Show a prominent class label section above or instead of the annotation overlay. Display format:
        ```
        Class: [dropdown with all categories]
        ```
      - Extract GT annotation: `const gtAnnotation = annotations?.find(a => a.source === "ground_truth");`
      - If predictions exist, also show: `Predicted: [predicted class label]` with confidence if available.
      - The class dropdown uses the categories list (from `useFilterFacets` or a categories fetch). On change, call `PATCH /annotations/{gtAnnotation.id}/category` with the new `category_name`.
      - Create a TanStack Query mutation hook inline or in a hooks file: `usePatchCategory` that calls `apiPatch(\`/annotations/\${annotationId}/category\`, { category_name })` and invalidates the annotation queries on success.
      - Do NOT render the annotation overlay / bounding box editor for classification datasets. Hide the bbox editing canvas (react-konva editor). The image should display without any overlay.
    - When `datasetType !== "classification"`: render everything as before (no change).

    **2. Annotation list** (`frontend/src/components/detail/annotation-list.tsx`):
    - Add `datasetType?: string` prop.
    - When `datasetType === "classification"`:
      - Hide the Bounding Box columns (bbox_x, bbox_y, bbox_w, bbox_h) and Area column from the table.
      - Show: Class, Source, Confidence columns only.
    - When detection: show all columns as before.

    **3. Stats dashboard** (`frontend/src/components/stats/stats-dashboard.tsx`):
    - Add `datasetType?: string` prop.
    - When `datasetType === "classification"`:
      - Hide the "Evaluation" tab entirely (no IoU-based evaluation for classification in this phase).
      - Hide the "Error Analysis" sub-panel (detection-specific error categories: TP/FP/FN based on IoU).
      - Keep: Class Distribution chart, Split Breakdown chart, Summary cards (with relabeled metrics).
      - Hide: Any bbox area histogram or IoU-related controls.
    - When detection: show all tabs/panels as before.

    **4. Annotation summary** (`frontend/src/components/stats/annotation-summary.tsx`):
    - Add `datasetType?: string` prop.
    - When `datasetType === "classification"`:
      - Swap summary card labels:
        - "GT Annotations" -> "Labeled Images"
        - "Categories" -> "Classes"
      - Keep "Total Images" and "Predictions" labels as-is.
    - When detection: show original labels.
    - Use a conditional card definitions array pattern:
      ```tsx
      const cards = datasetType === "classification"
        ? CLASSIFICATION_CARDS
        : DETECTION_CARDS;
      ```
  </action>
  <verify>
    - `cd frontend && npx tsc --noEmit` passes without errors
    - `cd frontend && npm run build` succeeds
    - Grep confirms classification branching: `grep -r "classification" frontend/src/components/detail/sample-modal.tsx`
    - Grep confirms stats adaptation: `grep -r "classification" frontend/src/components/stats/stats-dashboard.tsx`
    - Grep confirms annotation-summary adaptation: `grep -r "Labeled Images" frontend/src/components/stats/annotation-summary.tsx`
  </verify>
  <done>Detail modal shows class label with editable dropdown for classification datasets. Annotation list hides bbox columns for classification. Stats dashboard hides detection-only tabs/panels. Summary cards use classification-appropriate labels. PATCH mutation for category update wired. All TypeScript compiles cleanly.</done>
</task>

</tasks>

<verification>
1. Classification dataset grid shows class label badges (no bbox overlays)
2. Detail modal shows "Class: [dropdown]" for classification, with working category edit
3. Stats dashboard hides Evaluation tab and Error Analysis for classification
4. Summary cards show "Labeled Images" and "Classes" for classification
5. Annotation list hides bbox/area columns for classification
6. Scan results show "Classification JSONL" format badge
7. Detection datasets are completely unaffected (no regression)
8. TypeScript compiles and Next.js builds succeed
</verification>

<success_criteria>
- Classification datasets display class badges on grid thumbnails
- Detail modal has class label display with dropdown editor that persists changes
- Statistics dashboard shows only classification-relevant metrics
- Detection workflow is unchanged
- Frontend builds without errors
</success_criteria>

<output>
After completion, create `.planning/phases/15-classification-ingestion-display/15-02-SUMMARY.md`
</output>
